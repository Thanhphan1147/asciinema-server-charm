type: charm
base: ubuntu@24.04
build-base: ubuntu@24.04
platforms:
  amd64:

parts:
  charm:
    build-packages:
      - build-essential
      - python3-dev
      - pkg-config
      - libffi-dev
      - libssl-dev
      - git
    build-snaps:
      - rustup
    stage-snaps:
      - asciinema-server
    override-build: |
      rustup default stable
      craftctl default

name: asciinema-server
title: Asciinema server
summary: Asciinema server
description: Asciinema server
charm-libs:
  - lib: data_platform_libs.data_interfaces
    version: "0"
  - lib: traefik-k8s.ingress
    version: "2"

requires:
  database:
    interface: postgresql_client
    limit: 1
    optional: false
  server:
    interface: ingress
  admin:
    interface: ingress

assumes:
  - juju >= 3.3